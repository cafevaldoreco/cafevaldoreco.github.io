<!DOCTYPE html>
<html lang="es">
<head>
  <!-- CSP FINAL FUNCIONAL -->
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self';
               script-src 'self' 'unsafe-eval' 'unsafe-inline' https://www.gstatic.com https://apis.google.com;
               style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
               font-src 'self' https://fonts.gstatic.com;
               img-src 'self' data: https:;
               connect-src 'self' 
                 https://www.gstatic.com 
                 https://firestore.googleapis.com 
                 https://identitytoolkit.googleapis.com 
                 https://www.googleapis.com 
                 https://cafelaesperanza-231a4.firebaseapp.com
                 https://securetoken.googleapis.com;
               frame-src 'self' 
                 https://cafelaesperanza-231a4.firebaseapp.com 
                 https://apis.google.com;">

  <!-- Headers de seguridad -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CafÃ© Valdore - Descubre nuestros cafÃ©s especiales de origen. Granos premium tostados y molidos. EnvÃ­os a todo el paÃ­s.">
  <title>CafÃ© Valdore - CafÃ© Especial del Huila</title>

  <!-- âœ… Preconnect OPTIMIZADO - Solo los mÃ¡s crÃ­ticos -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://firestore.googleapis.com">
  <link rel="dns-prefetch" href="https://img.shields.io">

  <!-- âœ… Preload SOLO recursos CRÃTICOS (visibles en viewport inicial) -->
  <link rel="preload" href="styles.css" as="style">
  <link rel="preload" href="logo.webp" as="image" type="image/webp">
  
  <!-- CSS crÃ­tico inline para evitar render-blocking -->
  <style>
    /* CSS crÃ­tico para evitar FOUC */
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    header { background: #2c1810; position: sticky; top: 0; z-index: 1000; }
    .presentacion { min-height: 200px; }
    /* Skeleton loading para productos */
    .productos-grid { display: grid; gap: 2rem; }
    @media (min-width: 768px) { .productos-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1024px) { .productos-grid { grid-template-columns: repeat(3, 1fr); } }
  </style>

  <!-- CSS completo (serÃ¡ cacheado por el SW) -->
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="formulario.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="carrito.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="cerrarcarrito.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="contacto.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="productos.css" media="print" onload="this.media='all'">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
  <!-- Header con menÃº responsive -->
  <header>
    <nav>
      <a href="#" class="logo">
        <!-- LOGO SIN LAZY LOADING (es crÃ­tico y visible inmediatamente) -->
        <img src="logo.webp" alt="CafÃ© Valdore" style="height: 120px;">
      </a>
      
      <!-- MenÃº desktop -->
      <ul class="nav-links">
        <li><a href="index.html">ğŸ  Inicio</a></li>
        <li><a href="historia.html">ğŸ“– Nuestra Historia</a></li>
        <li><a href="pedidos.html">ğŸ“¦ Mis Pedidos</a></li>
        <li><a href="contacto.html">ğŸ“ ContÃ¡ctanos</a></li>
        <li><button id="carritoBtn" class="cart-btn">ğŸ›’ Carrito</button></li>
        <li><button id="authBtn" class="auth-btn">ğŸ”‘ Iniciar SesiÃ³n</button></li>
      </ul>

      <!-- BotÃ³n hamburguesa -->
      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </nav>

    <!-- MenÃº mÃ³vil -->
    <div class="mobile-menu" id="mobileMenu">
      <ul>
        <li><a href="index.html">ğŸ  Inicio</a></li>
        <li><a href="historia.html">ğŸ“– Nuestra Historia</a></li>
        <li><a href="pedidos.html">ğŸ“¦ Mis Pedidos</a></li>
        <li><a href="contacto.html">ğŸ“ ContÃ¡ctanos</a></li>
        <li><button id="carritoMobileBtn" class="cart-btn">ğŸ›’ Carrito</button></li>
        <li><button id="authMobileBtn" class="auth-btn">ğŸ”‘ Iniciar SesiÃ³n</button></li>
      </ul>
    </div>
  </header>

  <!-- PresentaciÃ³n -->
  <main>
    <section class="presentacion">
      <h2>Bienvenido al CafÃ© Especial del Huila</h2>
      <p>Desde el Valle de Laboyos, en las montaÃ±as de Pitalito-Huila, cultivamos cafÃ© especial con estÃ¡ndares de calidad excepcionales. Cada taza cuenta la historia de nuestra tierra y dedicaciÃ³n.</p>
      <div id="userWelcome" class="user-info" style="display: none;">
        <p>Â¡Bienvenido,  <span id="userName"></span> tu prÃ³xima taza favorita te espera! ğŸ‘‹</p>
      </div>
    </section>

    <!-- Productos -->
    <section class="productos">
      <h2>Nuestros CafÃ©s Especiales</h2>
      <div class="productos-grid">
        <div class="producto">
          <!-- IMAGEN CON LAZY LOADING -->
          <img src="bourbon.webp" alt="Bourbon Rosado" loading="lazy" width="250" height="250">
          <h3>Bourbon Rosado 500g</h3>
          <p>CafÃ© de tueste medio, con cuerpo ligero y sedoso. Presenta un perfil frutal y floral, con notas de cereza, fresa y miel, que se combinan con una dulzura natural que envuelve el paladar. Ideal para quienes disfrutan de un cafÃ© delicado, aromÃ¡tico y equilibrado, que despierta los sentidos sin ser agresivo.</p>
          <button class="add-to-cart-btn" data-producto="Bourbon Rosado" data-precio="50000">
            Agregar al Carrito â€¢ $50.000
          </button>
        </div>
        <div class="producto">
          <!-- IMAGEN CON LAZY LOADING -->
          <img src="caturra.webp" alt="Caturra" loading="lazy" width="250" height="250">
          <h3>Caturra 500g</h3>
          <p>CafÃ© de tueste medio, con cuerpo medio y textura cremosa. Destaca por su equilibrio entre acidez brillante y notas dulces, acompaÃ±adas de un aroma intenso a frutos secos y cacao. Una experiencia envolvente y compleja, ideal para quienes buscan un cafÃ© aromÃ¡tico, con carÃ¡cter y un sabor persistente.</p>
          <button class="add-to-cart-btn" data-producto="Caturra" data-precio="50000">
            Agregar al Carrito â€¢ $50.000
          </button>
        </div>
        <div class="producto">
          <!-- IMAGEN CON LAZY LOADING -->
          <img src="promocion.webp" alt="PromociÃ³n Bourbon + Caturra" loading="lazy" width="250" height="250">
          <h3>Gran PromociÃ³n Bourbon + Caturra 1000g</h3>
          <p>ğŸ”¥ Descubre el balance perfecto con nuestra combinaciÃ³n exclusiva de Bourbon y Caturra, dos cafÃ©s de origen Ãºnico que conquistan por su cuerpo medio, notas dulces y final cremoso.
Un cafÃ© premium, aromÃ¡tico y sofisticado para quienes disfrutan la excelencia en cada sorbo.
</p>
<p>ğŸŒEl cafÃ© que transforma cada momento en especial.</p>
<p>ğŸŒŸ El equilibrio perfecto en cada taza</p>
<p>â˜• Dos orÃ­genes, un sabor premium</p>
          <button class="add-to-cart-btn" data-producto="PromociÃ³n Bourbon + Caturra" data-precio="80000">
            Agregar al Carrito â€¢ $80.000
          </button>
        </div>
        <div class="producto">
          <!-- IMAGEN CON LAZY LOADING -->
          <img src="superpromocion.webp" alt="Super PromociÃ³n Bourbon + Caturra X2" loading="lazy" width="250" height="250">
          <h3>Super PromociÃ³n 2 bolsas de Bourbon + 2 bolsas de Caturra 2000g</h3>
          <p>ğŸ”¥ Lleva el doble y ahorra mÃ¡s con esta super promociÃ³n familiar: 2 bolsas de Bourbon y 2 bolsas de Caturra, 2000g de cafÃ© selecto para que nunca falte en casa. Vive una experiencia intensa y envolvente, con aromas de frutos secos, cacao y notas brillantes que harÃ¡n de cada preparaciÃ³n un momento especial.
ğŸ‘‰ MÃ¡s cafÃ©, mÃ¡s sabor, mÃ¡s ahorro.</p>
<p>ğŸ”¥ MÃ¡s cafÃ©, mÃ¡s sabor, mÃ¡s ahorro
</p>
<p>ğŸ‰ 2 + 2: la experiencia completa del cafÃ© premium</p>
          <button class="add-to-cart-btn" data-producto="Super PromociÃ³n Bourbon + Caturra X2" data-precio="100000">
            Agregar al Carrito â€¢ $100.000
          </button>
        </div>
      </div>
    </section>

    <!-- SecciÃ³n de preparaciÃ³n de cafÃ© -->
    <section class="preparacion-cafe">
      <h2>â˜• Â¿CÃ³mo Preparar la Taza Perfecta?</h2>
      <div class="preparacion-container">
        <div class="preparacion-content">
          <div class="preparacion-intro">
            <p>Nuestro cafÃ© molido estÃ¡ listo para preparar. Descubre los secretos para extraer todo el sabor y aroma de nuestros cafÃ©s especiales del Huila con estos mÃ©todos sencillos.</p>
          </div>
          
          <div class="metodos-preparacion">
            <div class="metodo">
              <h3>ğŸŒŸ MÃ©todo de Filtro (Recomendado)</h3>
              <div class="instrucciones">
                <div class="paso">
                  <span class="numero">1</span>
                  <p><strong>ProporciÃ³n:</strong> 2-3 cucharadas de cafÃ© por cada 250ml de agua</p>
                </div>
                <div class="paso">
                  <span class="numero">2</span>
                  <p><strong>Temperatura:</strong> 90-94Â°C (deja reposar el agua hirviendo 1 minuto)</p>
                </div>
                <div class="paso">
                  <span class="numero">3</span>
                  <p><strong>Filtro:</strong> Usa filtro de papel o permanente en tu cafetera de goteo</p>
                </div>
                <div class="paso">
                  <span class="numero">4</span>
                  <p><strong>PreparaciÃ³n:</strong> Vierte agua lentamente sobre el cafÃ© molido de manera uniforme</p>
                </div>
                <div class="paso">
                  <span class="numero">5</span>
                  <p><strong>ExtracciÃ³n:</strong> Deja que el agua pase completamente (4-6 minutos)</p>
                </div>
                <div class="paso">
                  <span class="numero">6</span>
                  <p><strong>Servir:</strong> Disfruta inmediatamente para mejor sabor</p>
                </div>
              </div>
            </div>

            <div class="metodo">
              <h3>â˜• MÃ©todo Tradicional Colombiano</h3>
              <div class="instrucciones">
                <div class="paso">
                  <span class="numero">1</span>
                  <p><strong>ProporciÃ³n:</strong> 3-4 cucharadas de cafÃ© por cada 300ml de agua</p>
                </div>
                <div class="paso">
                  <span class="numero">2</span>
                  <p><strong>Colador de tela:</strong> Usa un colador tradicional de tela o filtro permanente</p>
                </div>
                <div class="paso">
                  <span class="numero">3</span>
                  <p><strong>Agua caliente:</strong> Usa agua entre 88-92Â°C para resaltar la dulzura</p>
                </div>
                <div class="paso">
                  <span class="numero">4</span>
                  <p><strong>Proceso:</strong> Vierte el agua caliente sobre el cafÃ© en el colador</p>
                </div>
                <div class="paso">
                  <span class="numero">5</span>
                  <p><strong>Filtrado:</strong> Deja que el cafÃ© se filtre completamente (3-4 minutos)</p>
                </div>
                <div class="paso">
                  <span class="numero">6</span>
                  <p><strong>Endulzar:</strong> Opcional - aÃ±ade panela o azÃºcar al gusto</p>
                </div>
              </div>
            </div>
          </div>

          <div class="consejos-extra">
            <h3>ğŸ’¡ Consejos de los Expertos</h3>
            <div class="consejos-grid">
              <div class="consejo">
                <span class="icono">ğŸŒ¡ï¸</span>
                <h4>Temperatura Perfecta</h4>
                <p>Nunca uses agua hirviendo. La temperatura ideal resalta las notas dulces y frutales de nuestros cafÃ©s especiales.</p>
              </div>
              <div class="consejo">
                <span class="icono">ğŸº</span>
                <h4>Almacenamiento</h4>
                <p>Guarda el cafÃ© molido en un recipiente hermÃ©tico, en lugar fresco y seco, lejos de la luz directa.</p>
              </div>
              <div class="consejo">
                <span class="icono">ğŸ’§</span>
                <h4>Calidad del Agua</h4>
                <p>Usa agua filtrada. El 98% de tu taza es agua, asÃ­ que su calidad es fundamental.</p>
              </div>
              <div class="consejo">
                <span class="icono">ğŸ¥„</span>
                <h4>Medida Perfecta</h4>
                <p>Una cucharada sopera equivale aproximadamente a 7-8g de cafÃ© molido. Ajusta segÃºn tu gusto.</p>
              </div>
            </div>
          </div>

          <div class="cafe-valdore-tips">
            <h3>ğŸ”ï¸ Para Nuestros CafÃ©s del Huila</h3>
            <div class="tips-especiales">
              <div class="tip-bourbon">
                <h4>Bourbon Rosado</h4>
                <p>Para resaltar sus notas florales y de frutos rojos, usa agua a 92Â°C y prepÃ¡ralo con el mÃ©todo de filtro. Su perfil delicado y aromÃ¡tico se disfruta mejor sin azÃºcar para apreciar su dulzura natural.</p>
              </div>
              <div class="tip-caturra">
                <h4>Caturra</h4>
                <p>Su perfil equilibrado y cremoso se destaca con cualquier mÃ©todo. Para resaltar sus notas de cacao y frutos secos, usa agua a 90Â°C. Ideal tanto solo como con un toque de panela.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Mensaje para usuarios no autenticados -->
    <div id="loginMessage" class="login-required" style="display: none;">
      <div class="message-box">
        <h3>ğŸ” Inicia sesiÃ³n para comprar</h3>
        <p>Para agregar productos al carrito y realizar pedidos, necesitas tener una cuenta.</p>
        <button onclick="window.location.href='auth.html'" class="login-prompt-btn">
          Iniciar SesiÃ³n / Registrarse
        </button>
      </div>
    </div>

    <!-- Mensaje para usuarios no autenticados en chat-->
    <div id="loginChat" class="login-required" style="display: none;">
      <div class="message-box">
        <h3>ğŸ” Inicia sesiÃ³n para chatear</h3>
        <p>Para poder usar el chat de cafÃ© valdore, necesitas tener una cuenta.</p>
        <button onclick="window.location.href='auth.html'" class="login-prompt-btn">
          Iniciar SesiÃ³n / Registrarse
        </button>
      </div>
    </div>
  </main>

  <!-- Overlay del carrito -->
  <div class="carrito-overlay" id="carritoOverlay"></div>

  <!-- Carrito lateral -->
  <aside id="carrito" class="carrito-sidebar">
    <button id="cerrarCarrito" class="cerrarBtn">X</button>
    <h2>Tu Carrito ğŸ›’</h2>
    <ul id="listaCarrito"></ul>
    <p id="totalCarrito">Total: $0</p>
    <button id="guardarPedido" class="btn-confirmar">
      âœ… Confirmar Pedido
    </button>
    <button id="vaciarCarrito" class="btn-vaciar">
      ğŸ—‘ï¸ Vaciar Carrito
    </button>
  </aside>
  
  <!-- Footer -->
  <footer class="footer-contacto">
    <div class="footer-content">
      <div class="footer-section">
        <h3>â˜• CafÃ© Valdore</h3>
        <p>Desde el Valle de Laboyos, cultivamos y procesamos cafÃ© de la mÃ¡s alta calidad para los amantes del buen cafÃ©.</p>
      </div>
      
      <div class="footer-section">
        <h4>Enlaces RÃ¡pidos</h4>
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="historia.html">Nuestra Historia</a></li>
          <li><a href="pedidos.html">Mis Pedidos</a></li>
          <li><a href="contacto.html">ContÃ¡ctanos</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Redes Sociales</h4>
        <div class="social-links">
          <!-- BADGES DE REDES SOCIALES SIN LAZY LOADING (son pequeÃ±os y crÃ­ticos) -->
          <a href="https://www.facebook.com/profile.php?id=61580621437211" target="_blank">
            <img src="https://img.shields.io/badge/Facebook-094293?style=for-the-badge&logo=facebook&logoColor=white" alt="SÃ­gueme en Facebook">
          </a>
          <a href="https://www.instagram.com/cafevaldore/" target="_blank">
            <img src="https://img.shields.io/badge/Instagram-E4405F?style=for-the-badge&logo=instagram&logoColor=white" alt="SÃ­gueme en Instagram">
          </a>
          <a href="mailto:cafevaldore@gmail.com" target="_blank">
            <img src="https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white" alt="Email me">
          </a>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 CafÃ© Valdore.
        <span class="admin-link" onclick="window.location.href='admin-login.html'">
          Todos los derechos reservados
        </span>
      </p>
    </div>
  </footer>

  <!-- Chat flotante para comunicaciÃ³n con administrador -->
  <div class="chat-container" id="chatContainer">
    <button class="chat-toggle" id="chatToggle">
      ğŸ’¬
      <span class="chat-badge" id="chatBadge" style="display: none;">0</span>
    </button>
    
    <div class="chat-window" id="chatWindow">
      <div class="chat-header">
        <h3>ğŸ’¬ Chat con CafÃ© Valdore</h3>
        <button class="chat-close" id="chatClose">&times;</button>
      </div>
      
      <div class="chat-messages" id="chatMessages">
        <!-- Los mensajes se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
        <div class="chat-welcome">
          <p>Â¡Hola! Â¿En quÃ© podemos ayudarte?</p>
          <p>Estamos aquÃ­ para responder tus preguntas sobre nuestros productos, pedidos o cualquier consulta que tengas.</p>
        </div>
      </div>
      
      <div class="chat-input">
        <textarea id="mensajeChat" placeholder="Escribe tu mensaje aquÃ­..." rows="2"></textarea>
        <button id="enviarMensajeChat">ğŸ“¤</button>
      </div>
    </div>
  </div>


<!-- âœ… Solo main.js - Firebase se carga automÃ¡ticamente cuando se necesita -->
<!-- AL FINAL DEL BODY -->
<script type="module" src="main.js"></script>
<script type="module" src="chat.js"></script>


<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('âœ… SW registrado'))
      .catch(err => console.log('âŒ SW error:', err));
  });
}
</script>
</body>
</html>

</body>
</html>